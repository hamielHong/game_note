排行榜模块  思路整理
===

排行榜实时刷新
---

某一个玩家达成刷新排行榜的条件时就来这个模块，比如说升级了要刷等级榜，打完副本了要刷副本记录榜。

每一个排行榜的刷新可以做一个接口供外部刷新时调用。

内部的排行榜刷新逻辑可以抽出来做成一个通用的方法，因为大部分排行榜的刷新逻辑都差不多：

* 最佳纪录型排行榜 如副本记录榜

    1、看排行榜满了没，没满就直接往里加

    2、排行榜满了就对比一下与最后一名比是否能够上榜

    3、能够上榜的要查一下榜里是否已经有同一个玩家的记录，有就比较一下有没有比之前好

    4、比之前好的记录就把之前的删除，把新的加入，然后排序成榜

    5、之前没有记录的，就加入然后排序成榜

* 实时状态型排行榜 如战力榜

    实时刷新型榜的难点在于，如何处理玩家积分减少的情况，按照原来的逻辑，当玩家积分减少时，难以判断是否掉出了榜单，因为没有第101人的数据。可以考虑存101个人

    1、看排行榜满了没，没满就直接往里加

    2、上榜时要先查一下以前有没有记录，有要把以前的删掉

    3、之后再对比一下自己跟最后一名的战力，也就是101名，比最后一名低的话，就移出榜单。

    4、比最后一名高，就加进榜单

    5、按照这种思路，可以多存几个人预备比较稳妥，比如多存10个。

    6、最后排好序，截掉多余的，留下101个或者110个

    7、最后排行榜传给前端时再截取要的数量，也就是100个